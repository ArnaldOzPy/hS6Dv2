<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Compresi√≥n HyperStorage6D</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f9f9f9; }
    pre { background: #fff; padding: 1rem; border: 1px solid #ddd; max-height: 300px; overflow: auto; }
    .block { margin-top: 2rem; }
  </style>
</head>
<body>
  <h2>HyperStorage6D ‚Äì Compresor Experimental</h2>

  <div class="block">
    <input type="file" id="fileInput">
    <button onclick="procesarArchivo()">üì¶ Comprimir</button>
  </div>

  <div class="block">
    <h3>üì§ Resultado:</h3>
    <pre id="output">Esperando archivo...</pre>
  </div>

  <script>
    function procesarArchivo() {
      const input = document.getElementById('fileInput');
      const output = document.getElementById('output');

      if (!input.files || input.files.length === 0) {
        output.textContent = "‚ö†Ô∏è No se seleccion√≥ ning√∫n archivo.";
        return;
      }

      const archivo = input.files[0];
      const lector = new FileReader();

      lector.onload = function(e) {
        const arrayBuffer = e.target.result;
        const byteArray = new Uint8Array(arrayBuffer);

        // Compresi√≥n
        const comprimido = hyperCompress(byteArray);

        output.textContent =
          `‚úÖ Archivo cargado: ${archivo.name}\n` +
          `üî∏ Tama√±o original: ${byteArray.length} bytes\n` +
          `üî∏ Tama√±o comprimido: ${comprimido.length} bytes\n` +
          `üî∏ Ratio: ${((comprimido.length / byteArray.length) * 100).toFixed(2)}%\n` +
          `üîπ CRC32: ${crc32(byteArray)}\n` +
          `üßæ Vista comprimida: [${comprimido.slice(0, 200).join(', ')}...]`;
      };

      lector.onerror = function() {
        output.textContent = "‚ùå Error al leer el archivo.";
      };

      lector.readAsArrayBuffer(archivo);
    }

    function hyperCompress(data) {
      const blockSize = 512;
      const compressed = [];

      for (let i = 0; i < data.length; i += blockSize) {
        const block = data.slice(i, i + blockSize);
        const rep = detectRepetitions(block);
        compressed.push(...rep);
      }

      return new Uint8Array(compressed);
    }

    function detectRepetitions(block) {
      const result = [];
      for (let i = 0; i < block.length;) {
        let repeatCount = 1;
        while (
          i + repeatCount < block.length &&
          block[i] === block[i + repeatCount] &&
          repeatCount < 255
        ) {
          repeatCount++;
        }
        if (repeatCount > 3) {
          result.push(0); // marcador de repetici√≥n
          result.push(block[i]); // valor
          result.push(repeatCount); // repeticiones
          i += repeatCount;
        } else {
          result.push(block[i]);
          i++;
        }
      }
      return result;
    }

    function crc32(buf) {
      let crc = 0xffffffff;
      for (let i = 0; i < buf.length; i++) {
        let byte = buf[i];
        crc = crc ^ byte;
        for (let j = 0; j < 8; j++) {
          const mask = -(crc & 1);
          crc = (crc >>> 1) ^ (0xedb88320 & mask);
        }
      }
      return ((crc ^ 0xffffffff) >>> 0).toString(16).toUpperCase();
    }
  </script>
</body>
</html>
